Reference: http://docs.ceph.com/docs/mimic/install/manual-deployment/

# Build from source.
git submodule update --init --recursive
./install-deps.sh
./do_cmake.sh
cd build
make
sudo make install

# 1 mon, many osds.
# All processes are running by root.

# Launching monitor daemon.
# ssh to monitor node.
sudo mkdir -p /etc/ceph
sudo vim /etc/ceph/ceph.conf

# Copy and paste it into the ceph configuration file.
[global]
fsid = c16c8ea8-31ab-4940-b971-d2edf940de1c
mon_initial_members = cephnode1
mon_host = 192.168.1.31
auth_cluster_required = cephx
auth_service_required = cephx
auth_client_required = cephx

sudo -u ceph ceph-authtool --create-keyring /tmp/ceph.mon.keyring --gen-key -n mon. --cap mon 'allow *'
sudo ceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --set-uid=0 --cap mon 'allow *' --cap osd 'allow *' --cap mds 'allow *' --cap mgr 'allow *'
sudo mkdir -p /var/lib/ceph/bootstrap-osd
sudo chown -R ceph:ceph /var/lib/ceph
sudo -u ceph sudo ceph-authtool --create-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring --gen-key -n client.bootstrap-osd --cap mon 'profile bootstrap-osd'
sudo ceph-authtool /tmp/ceph.mon.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring
sudo ceph-authtool /tmp/ceph.mon.keyring --import-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring
sudo -u ceph monmaptool --create --add cephnode1 192.168.1.31 --fsid c16c8ea8-31ab-4940-b971-d2edf940de1c /tmp/monmap
sudo -u ceph mkdir -p /var/lib/ceph/mon/ceph-cephnode1
sudo -u ceph ceph-mon --mkfs -i cephnode1 --monmap /tmp/monmap --keyring /tmp/ceph.mon.keyring
sudo -u ceph touch /var/lib/ceph/mon/ceph-cephnode1/done
sudo chmod +r /etc/ceph/ceph.client.admin.keyring

# Copy systemd files into the /lib/systemd/system directory at all ceph nodes.

# Run ceph monitor in background.
sudo systemctl start ceph-mon@cephnode1

# Gather keys from another nodes.
ssh cephnode2
sudo mkdir -p /var/lib/ceph/osd
sudo mkdir -p /var/lib/ceph/bootstrap-osd
# Copy keyring into bootstrap-osd
sudo chown -R ceph:ceph /var/lib/ceph
sudo mkdir -p /etc/ceph
# Copy ceph.conf and admin.keyring

# Deploy osd.
sudo -u ceph mkdir -p /var/lib/ceph/osd
sudo ceph-volume lvm zap /dev/sda
sudo ceph-volume lvm create --data /dev/sda

# Check the ceph status.
ceph -s

