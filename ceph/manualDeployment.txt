Reference: http://docs.ceph.com/docs/mimic/install/manual-deployment/

# Build from source.
git submodule update --init --recursive
./install-deps.sh
./do_cmake.sh
cd build
make
sudo make install

# 1 mon, many osds.
# All processes are running by root.

# Launching monitor daemon.
# ssh to monitor node.
sudo mkdir -p /etc/ceph
sudo vim /etc/ceph/ceph.conf

# Copy and paste it into the ceph configuration file.
[global]
fsid = c16c8ea8-31ab-4940-b971-d2edf940de1c
mon_initial_members = cephnode1
mon_host = 192.168.1.31
auth_cluster_required = cephx
auth_service_required = cephx
auth_client_required = cephx

ceph-authtool --create-keyring /tmp/ceph.mon.keyring --gen-key -n mon. --cap mon 'allow *'
sudo ceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --set-uid=0 --cap mon 'allow *' --cap osd 'allow *' --cap mds 'allow *' --cap mgr 'allow *'
sudo mkdir -p /var/lib/ceph/bootstrap-osd
sudo ceph-authtool --create-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring --gen-key -n client.bootstrap-osd --cap mon 'profile bootstrap-osd'
sudo ceph-authtool /tmp/ceph.mon.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring
sudo ceph-authtool /tmp/ceph.mon.keyring --import-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring
monmaptool --create --add cephnode1 192.168.1.31 --fsid c16c8ea8-31ab-4940-b971-d2edf940de1c /tmp/monmap
sudo mkdir -p /var/lib/ceph/mon/ceph-cephnode1
sudo -u ceph ceph-mon --mkfs -i cephnode1 --monmap /tmp/monmap --keyring /tmp/ceph.mon.keyring
sudo touch /var/lib/ceph/mon/ceph-cephnode1/done

# Run ceph monitor in background.
sudo ceph-mon -f --cluster ceph --id cephnode1 &

# Check the ceph status.
sudo chmod +r /etc/ceph/ceph.client.admin.keyring
ceph -s

